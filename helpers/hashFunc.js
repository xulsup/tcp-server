'use strict'

const crypto = require('crypto')

const pwdBuffer = Buffer.from([
  0x42, 0x12, 0xee, 0x75, 0xea, 0x88, 0x58, 0x66, 0x79, 0xa8,
  0x6a, 0x48, 0xae, 0xc8, 0xbb, 0xd7, 0xd4, 0x12, 0x01, 0xae,
  0xc6, 0x00, 0xce, 0x88, 0xaa, 0xae, 0x64, 0xaa, 0x00, 0x00,
  0x00, 0x00
])

const fixVal = Buffer.from([
  0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xee, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x23, 0x00, 0x00
])

module.exports = function (raw) {
  const len = pwdBuffer.length + fixVal.length + raw.length
  const clcBuffer = Buffer.concat([pwdBuffer, raw, fixVal], len)

  const hashFunc = crypto.createHash('sha256')
  const hashBuffer = hashFunc.update(clcBuffer).digest()

  const resLen = hashBuffer.length + raw.length

  const resBuffer = Buffer.concat([raw, hashBuffer], resLen)

  return resBuffer
}
